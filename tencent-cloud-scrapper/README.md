# 腾讯云轻量应用服务器自动抢购工具

这是一个基于 Playwright 的自动抢购腾讯云轻量应用服务器的工具，支持定时抢购功能。

## 功能特点

- 🕒 **定时抢购**: 每天上午10点和下午3点自动执行抢购任务
- 🎯 **智能识别**: 自动识别轻量应用服务器产品和抢购按钮
- 🔍 **多重选择器**: 使用多种CSS选择器确保元素定位的准确性
- 📸 **调试截图**: 自动保存页面截图用于调试
- ⚡ **快速响应**: 优化的页面加载和元素查找逻辑

## 安装依赖

```bash
cd /Users/yiying/dev-app/wedding-client/tencent-cloud-scrapper
npm install
```

## 使用方法

### 1. 安装依赖和浏览器

```bash
cd /Users/yiying/dev-app/wedding-client/tencent-cloud-scrapper
npm install
npx playwright install
```

### 2. 运行简单测试

首先运行简单测试确保Playwright正常工作：

```bash
node simple-test.js
```

### 3. 启动定时任务

```bash
node index.js
```

程序将自动在每天上午10:00和下午15:00执行抢购任务。

### 4. 测试抢购功能

运行测试脚本来验证抢购功能：

```bash
node test.js
```

或者立即测试抢购功能，可以取消 `index.js` 文件末尾的注释：

```javascript
// 取消下面这行的注释进行立即测试
buyServer();
```

### 5. 启用实际抢购

**⚠️ 重要提醒**: 默认情况下，程序只会模拟到找到抢购按钮的步骤，不会实际点击。

要启用实际抢购，需要在 `index.js` 文件中找到以下注释块并取消注释：

```javascript
// 注意：这里取消注释以启用实际点击
/*
try {
    await buyButton.click();
    // ... 其他代码
} catch (clickError) {
    // ... 错误处理
}
*/
```

## 配置说明

### 目标页面

当前配置的抢购页面为腾讯云限时秒杀活动页面，主要针对：
- **产品**: 轻量应用服务器
- **配置**: 4核4G3M，300GB月流量
- **价格**: 38元/月

### 定时设置

```javascript
// 每天上午10点和下午3点执行
cron.schedule('0 10,15 * * *', () => {
    buyServer();
}, {
    scheduled: true,
    timezone: "Asia/Shanghai"
});
```

## 注意事项

1. **登录要求**: 抢购需要腾讯云账号登录，程序会检测登录状态并提示手动完成登录

2. **库存检查**: 程序会自动检查商品是否已抢光，避免无效操作

3. **浏览器模式**: 默认使用非无头模式 (`headless: false`)，可以看到浏览器操作过程

4. **调试功能**: 
   - 自动保存调试截图到 `debug-page.png`
   - 错误时保存截图到 `click-error.png`

5. **安全提醒**: 
   - 请确保在安全的网络环境下使用
   - 建议先进行测试，确认功能正常后再启用实际抢购
   - 抢购成功后需要手动完成支付流程

## 故障排除

### 常见问题

1. **浏览器未安装**: 运行 `npx playwright install` 安装浏览器
2. **找不到元素**: 检查页面是否正常加载，查看调试截图
3. **网络超时**: 检查网络连接，适当增加超时时间
4. **页面结构变化**: 腾讯云可能更新页面结构，需要更新选择器

### 调试步骤

1. **运行简单测试**: `node simple-test.js` 确保Playwright正常工作
2. **运行功能测试**: `node test.js` 测试抢购页面访问
3. **查看日志**: 检查控制台输出的详细日志
4. **检查截图**: 查看生成的调试截图文件
5. **手动验证**: 手动访问目标页面确认元素是否存在

### 文件说明

- `index.js`: 主程序，包含定时任务和抢购逻辑
- `test.js`: 测试脚本，用于验证抢购功能
- `simple-test.js`: 简单测试，验证Playwright基本功能
- `README.md`: 使用说明文档

## 免责声明

本工具仅供学习和研究使用，使用者需要：
- 遵守腾讯云的服务条款
- 承担使用本工具的所有风险
- 确保抢购行为的合法性

作者不对使用本工具造成的任何损失承担责任。