# Wedding Client 监控任务配置
# 使用方法: crontab deployment/crontab-monitoring

# 设置环境变量
SLACK_WEBHOOK_URL=your_slack_webhook_url_here
PATH=/usr/local/bin:/usr/bin:/bin
SHELL=/bin/bash

# 每5分钟执行一次健康检查
*/5 * * * * cd /path/to/wedding-client && ./deployment/health-check.sh >> /var/log/wedding-health-check.log 2>&1

# 每小时执行一次完整的系统检查
0 * * * * cd /path/to/wedding-client && ./deployment/health-check.sh --system-only >> /var/log/wedding-system-check.log 2>&1

# 每天凌晨2点清理旧的Docker镜像（保留最近3个版本）
0 2 * * * docker image prune -f && docker images | grep 'ghcr.io/your-username/wedding-client' | tail -n +4 | awk '{print $3}' | xargs -r docker rmi

# 每周日凌晨3点清理Docker系统缓存
0 3 * * 0 docker system prune -f

# 每天凌晨1点备份重要配置文件
0 1 * * * tar -czf /backup/wedding-config-$(date +\%Y\%m\%d).tar.gz /path/to/wedding-client/deployment/*.yml /path/to/wedding-client/deployment/*.conf

# 每月1号清理超过30天的备份文件
0 0 1 * * find /backup -name "wedding-config-*.tar.gz" -mtime +30 -delete

# 每天检查磁盘空间，如果使用率超过80%则发送警告
0 */6 * * * df -h | awk '$5 > 80 {print $0}' | while read line; do echo "Disk usage warning: $line" | logger -t wedding-monitor; done